[transmogrifier]
title = Plone Export Site Object
description =
include = plone.export.content.config
pipeline = plone.export.site

[plone.export.site]
blueprint = transmogrifier.pipeline
pipeline =
    plone.export.site.purge
    plone.export.site.object
    plone.export.site.get_path
    plone.export.content.config.get_properties
    plone.export.content.config.get_context_portlets
    plone.export.site.send

[plone.export.site.purge]
blueprint = transmogrifier.filter
condition = python:False

[plone.export.site.object]
blueprint = transmogrifier.from
items = python:[dict(_object=context.portal_url.getPortalObject())]

[plone.export.site.get_path]
blueprint = transmogrifier.set
_path = python:'/'.join(item['_object'].getPhysicalPath())

[plone.export.site.send]
blueprint = rabbitpy.producer
routing-key = plone.export.site
queue = plone.export.site
queue-auto-declare = True
queue-auto-delete = False
serializer = pickle
keys =
    _path
    _properties
    _portlets
